<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLOOMBERG ENS¬Æ - GOD MODE v10</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        :root { --bg: #050505; --amber: #ffaa00; --dim: #555; --green: #00ff41; --red: #ff3333; --liq: #00d9ff; --border: #222; --panel-bg: #0a0a0a; --purple: #9d00ff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Consolas', 'Monaco', monospace; user-select: none; }
        body { background: var(--bg); color: var(--amber); height: 100vh; display: flex; flex-direction: column; overflow: hidden; font-size: 11px; }
        
        /* SCROLLBARS */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        ::-webkit-scrollbar-track { background: #000; }

        /* ANIMATIONS & UTILS */
        .hidden { display: none !important; }
        @keyframes flash { 0% { background-color: #333; } 100% { background-color: transparent; } }
        .flash-up { animation: flash 0.3s; color: var(--green); }
        .flash-down { animation: flash 0.3s; color: var(--red); }
        .pop-toast { animation: slideIn 0.5s ease-out forwards; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* LAYOUT ELEMENTS */
        .ticker-wrap { width: 100%; overflow: hidden; background: #080808; border-bottom: 1px solid #333; white-space: nowrap; padding: 2px 0; font-size: 10px; }
        .ticker { display: inline-block; animation: ticker 60s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .tick-item { margin-right: 20px; cursor: pointer; color: #666; transition: color 0.2s; }
        .tick-item:hover { color: var(--amber); }

        .header { background: #111; border-bottom: 1px solid var(--amber); padding: 4px 10px; display: flex; justify-content: space-between; align-items: center; height: 32px; }
        .brand { font-weight: 900; color: var(--amber); letter-spacing: 1px; }
        
        /* SEARCH BAR */
        .search-box { display: flex; align-items: center; background: #000; border: 1px solid #333; padding: 0 5px; width: 200px; }
        .search-icon { color: #555; margin-right: 5px; }
        #symbol-input { background: transparent; border: none; color: #fff; width: 100%; text-transform: uppercase; font-weight: bold; outline: none; padding: 3px 0; }

        /* GRID SYSTEM */
        .grid { display: grid; grid-template-columns: 260px 1fr 300px; grid-template-rows: 32px 1fr 180px; gap: 1px; background: var(--border); flex-grow: 1; overflow: hidden; }
        .panel { background: var(--panel-bg); display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .title { background: #111; padding: 4px 8px; border-bottom: 1px solid var(--border); color: #888; font-weight: bold; display: flex; justify-content: space-between; font-size: 10px; align-items: center; }

        /* TABS */
        .tabs-bar { grid-column: span 3; background: #080808; display: flex; align-items: center; border-bottom: 1px solid var(--border); padding: 0 5px; gap: 2px; }
        .pair-badge { background: var(--amber); color: #000; font-weight: 900; font-size: 12px; padding: 2px 8px; margin-right: 10px; border-radius: 2px; }
        .tab-btn { background: #151515; border: 1px solid #333; color: #666; padding: 4px 12px; cursor: pointer; font-size: 10px; min-width: 80px; transition: all 0.2s; }
        .tab-btn:hover { color: #fff; background: #222; }
        .tab-btn.active { border-bottom: 2px solid var(--amber); color: var(--amber); background: #111; font-weight: bold; }
        .tab-purple.active { border-color: var(--purple); color: var(--purple); } 
        .tab-spacer { flex-grow: 1; }

        /* TRADING UI */
        .trade-panel { padding: 10px; display: flex; flex-direction: column; gap: 8px; border-bottom: 1px solid #333; overflow-y: auto; }
        .input-group { display: flex; flex-direction: column; gap: 2px; margin-bottom: 5px; }
        .lbl { font-size: 9px; color: #666; text-transform: uppercase; }
        .t-input { background: #000; border: 1px solid #444; color: var(--amber); padding: 5px; width: 100%; text-align: right; font-weight: bold; font-family: monospace; }
        .lev-container { display: flex; align-items: center; gap: 5px; font-size: 9px; color: #888; background: #111; padding: 5px; border: 1px solid #333; }
        .slider { -webkit-appearance: none; width: 100%; height: 2px; background: #444; outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 10px; height: 10px; background: var(--amber); cursor: pointer; border-radius: 50%; }
        
        .btn-trade { width: 100%; padding: 8px; border: none; cursor: pointer; font-weight: 800; color: #000; text-transform: uppercase; margin-top:2px; }
        .btn-buy { background: var(--green); } .btn-sell { background: var(--red); }
        .position-box { background: #111; border-left: 3px solid #666; padding: 8px; display: none; margin-top: 5px; }

        /* LISTS & TABLES */
        .list { overflow-y: auto; flex-grow: 1; }
        .row { display: flex; justify-content: space-between; padding: 2px 8px; font-size: 10px; border-bottom: 1px solid #111; }
        .row:hover { background: #111; }
        
        /* DEPTH HEATMAP */
        .depth-row { display: flex; justify-content: space-between; position: relative; padding: 1px 8px; font-size: 10px; }
        .depth-bg { position: absolute; top: 0; right: 0; bottom: 0; opacity: 0.2; z-index: 0; transition: width 0.2s; }
        .depth-val { position: relative; z-index: 1; }
        .bg-ask { background-color: var(--red); } .bg-bid { background-color: var(--green); }

        /* --- BLOCKCHAIN TAB STYLES --- */
        #chain-container { width: 100%; height: 100%; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 1px; background: var(--border); }
        .chain-box { background: var(--panel-bg); padding: 10px; overflow-y: auto; display: flex; flex-direction: column; }
        .chain-header { color: var(--purple); font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; display: flex; justify-content: space-between; }
        
        .gas-meter { display: flex; gap: 10px; align-items: center; margin: 10px 0; }
        .gas-val { font-size: 24px; font-weight: bold; color: #fff; }
        .gas-lbl { color: #666; font-size: 10px; }
        
        .wallet-input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 5px; margin-bottom: 5px; font-family: monospace; }
        .token-list-item { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px dashed #222; }
        
        /* FOOTER */
        .foot { background: #080808; border-top: 1px solid #333; padding: 4px 10px; color: #666; display: flex; justify-content: space-between; font-size: 10px; align-items: center; height: 30px; }
        
        /* TOASTS */
        #toast-container { position: absolute; bottom: 40px; right: 20px; width: 250px; display: flex; flex-direction: column; gap: 5px; pointer-events: none; z-index: 100; }
        .toast { background: #111; border: 1px solid var(--amber); color: #fff; padding: 10px; pointer-events: auto; box-shadow: 0 5px 15px #000; }
    </style>
</head>
<body>

    <div class="ticker-wrap">
        <div class="ticker" id="global-ticker">INITIALIZING MARKET STREAM...</div>
    </div>

    <div class="header">
        <div style="display:flex; gap:15px; align-items:center;">
            <span class="brand">BLOOMBERG ENS¬Æ <span style="font-size:9px; color:#666; font-weight:normal;">v10 GOD MODE</span></span>
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" id="symbol-input" placeholder="SEARCH PAIR (e.g. SOLUSDT)" onkeypress="handleSearch(event)">
            </div>
        </div>
        <div style="display:flex; gap:15px; align-items:center; font-size:10px;">
            <span>GAS: <span id="header-gas" style="color:var(--purple)">--</span> Gwei</span>
            <span id="connection-status" style="color:var(--dim)">‚óè CONNECTING</span>
            <span id="clock">--:--:-- UTC</span>
        </div>
    </div>

    <div class="grid">
        <div class="tabs-bar">
            <span class="pair-badge" id="current-pair-disp">BTCUSDT</span>
            <button class="tab-btn active" onclick="setTab('chart', this)">TRADING VIEW</button>
            <button class="tab-btn tab-purple" onclick="setTab('chain', this)">BLOCKCHAIN DATA</button>
            <button class="tab-btn" onclick="setTab('depth', this)">DEPTH MAP</button>
            <div class="tab-spacer"></div>
            <button class="tab-btn" onclick="toggleHistory()">HISTORY</button>
        </div>

        <div class="panel" style="grid-row: span 2;">
            <div class="title"><span style="color:var(--green)">PAPER TRADING</span><span>WALLET</span></div>
            <div class="trade-panel">
                <div style="display:flex; justify-content:space-between; color:#aaa; font-size:10px;"><span>BALANCE</span><span id="wallet-bal" style="color:#fff; font-weight:bold">$10,000.00</span></div>
                
                <div class="input-group">
                    <span class="lbl">Size (USD)</span>
                    <input type="number" id="trade-size" class="t-input" value="1000">
                </div>
                
                <div class="lev-container">
                    <span class="lbl">LEV: <span id="lev-disp" style="color:#fff;">20x</span></span>
                    <input type="range" min="1" max="125" value="20" class="slider" oninput="el('lev-disp').innerText=this.value+'x'">
                </div>

                <div style="display:flex; gap:5px; margin-top:5px;">
                    <button class="btn-trade btn-buy" onclick="openPosition('long')">LONG</button>
                    <button class="btn-trade btn-sell" onclick="openPosition('short')">SHORT</button>
                </div>

                <div id="position-box" class="position-box">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px; color:#888;">
                        <span id="pos-side" style="font-weight:bold">LONG</span>
                        <span id="pos-entry">@ 0.00</span>
                    </div>
                    <div id="pos-pnl" style="font-size:16px; font-weight:900; text-align:center; margin:5px 0;">0.00%</div>
                    <button onclick="closePosition()" style="width:100%; background:#333; border:none; color:#fff; cursor:pointer;">CLOSE</button>
                </div>
            </div>

            <div class="title"><span>ORDER BOOK</span><span>L2 DATA</span></div>
            <div class="list">
                <div id="asks" style="display:flex; flex-direction:column-reverse;"></div>
                <div id="spread" style="text-align:center; color:#444; border-top:1px solid #222; border-bottom:1px solid #222; font-size:9px;">-</div>
                <div id="bids"></div>
            </div>
        </div>

        <div class="panel" style="grid-row: span 2;">
            <div id="tv-container" style="width:100%; height:100%;"></div>
            
            <div id="chain-container" class="hidden">
                <div class="chain-box">
                    <div class="chain-header"><span>NETWORK HEALTH</span><span>ETH MAINNET</span></div>
                    <div class="gas-meter">
                        <span style="font-size:30px;">‚õΩ</span>
                        <div>
                            <div class="gas-val" id="chain-gas">24</div>
                            <div class="gas-lbl">GWEI (Standard)</div>
                        </div>
                    </div>
                    <div style="margin-top:10px;">
                        <div class="row"><span>TPS (Real-time)</span><span style="color:#fff">14.2 tx/s</span></div>
                        <div class="row"><span>Last Block</span><span id="last-block" style="color:var(--amber)">#1829304</span></div>
                        <div class="row"><span>Difficulty</span><span>High</span></div>
                    </div>
                    <div style="margin-top:20px; border-top:1px solid #222; padding-top:10px;">
                        <div class="chain-header"><span>FEAR & GREED</span></div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div style="width:40px; height:40px; border-radius:50%; background:var(--green); display:flex; align-items:center; justify-content:center; color:#000; font-weight:bold;" id="fng-val">74</div>
                            <div style="font-size:14px; font-weight:bold;" id="fng-txt">GREED</div>
                        </div>
                    </div>
                </div>

                <div class="chain-box">
                    <div class="chain-header"><span>WALLET INSPECTOR</span><span>TRACKER</span></div>
                    <input type="text" class="wallet-input" id="wallet-addr" placeholder="Paste 0x Address..." onkeypress="if(event.key==='Enter') scanWallet()">
                    <div id="wallet-result" class="hidden">
                        <div style="color:#aaa; font-size:9px; margin-bottom:5px;">TOTAL NET WORTH</div>
                        <div style="font-size:18px; color:#fff; font-weight:bold; margin-bottom:10px;" id="wallet-worth">$0.00</div>
                        <div id="token-list"></div>
                    </div>
                    <div id="wallet-loading" class="hidden" style="color:var(--purple); text-align:center; margin-top:20px;">
                        <span class="blink">SCANNING BLOCKCHAIN...</span>
                    </div>
                </div>

                <div class="chain-box">
                    <div class="chain-header"><span>DEFI PROTOCOLS</span><span>TVL</span></div>
                    <div class="row"><span>LIDO STAKED ETH</span><span style="color:var(--green)">$34.2B</span></div>
                    <div class="row"><span>AAVE V3</span><span style="color:var(--green)">$12.5B</span></div>
                    <div class="row"><span>MAKER DAO</span><span style="color:var(--green)">$8.1B</span></div>
                    <div class="row"><span>UNISWAP V3</span><span style="color:var(--green)">$5.4B</span></div>
                    <div style="margin-top:10px; font-size:9px; color:#555;">*Based on estimated on-chain data</div>
                </div>

                <div class="chain-box">
                    <div class="chain-header"><span>WHALE ALERT</span><span>MEMPOOL</span></div>
                    <div id="whale-list" style="font-size:9px;"></div>
                </div>
            </div>
            
            <div id="depth-placeholder" class="hidden" style="display:flex; justify-content:center; align-items:center; height:100%; color:#444;">DEPTH VISUALIZER (Simulated)</div>
        </div>

        <div class="panel">
            <div class="title"><span>TAPE</span><span>TRADES</span></div>
            <div id="tape" class="list"></div>
        </div>
        
        <div class="panel">
            <div class="title"><span>INTELLIGENCE</span><span>NEWS</span></div>
            <div id="news-feed" class="list" style="padding:5px;"></div>
        </div>
    </div>

    <div class="panel" style="height:120px; border-top:1px solid #333; display:none;" id="history-panel">
        <div class="title"><span>TRADE HISTORY</span><button onclick="toggleHistory()" style="background:none;border:none;color:#fff;">X</button></div>
        <div class="list" id="history-list"></div>
    </div>

    <div class="foot">
        <div style="display:flex; gap:20px;">
            <span>PRICE: <span id="ft-price" style="color:#fff">--</span></span>
            <span>24H: <span id="ft-chg">--</span></span>
            <span>VOL: <span id="ft-vol">--</span></span>
        </div>
        <div style="display:flex; gap:10px;">
            <button onclick="toggleSound()" style="background:none; border:1px solid #333; color:#666; cursor:pointer;">SOUND</button>
            <button onclick="resetApp()" style="background:none; border:1px solid #333; color:#666; cursor:pointer;">RESET</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        // --- CONFIG & STATE ---
        let state = {
            pair: 'btcusdt',
            wallet: 10000,
            position: null,
            history: [],
            sound: false
        };
        const el = id => document.getElementById(id);
        let ws = null, audioCtx = null;

        // --- 1. SEARCH & PAIR SWITCHING (FIXED) ---
        function handleSearch(e) {
            if (e.key === 'Enter') {
                let val = e.target.value.trim().toUpperCase();
                if (!val) return;
                // Auto-append USDT if missing
                if (!val.endsWith('USDT') && !val.endsWith('BTC') && !val.endsWith('ETH')) val += 'USDT';
                
                switchPair(val);
                e.target.value = ''; // Clear input
            }
        }

        function switchPair(newPair) {
            state.pair = newPair.toLowerCase();
            el('current-pair-disp').innerText = state.pair.toUpperCase();
            
            // Re-init WebSocket & Chart
            startStream(state.pair);
            initTV();
            
            showToast("SYSTEM", `SWITCHED TO ${state.pair.toUpperCase()}`);
            document.title = `${state.pair.toUpperCase()} | BLOOMBERG v10`;
        }

        // --- 2. TRADING ENGINE (SIMPLIFIED) ---
        function openPosition(side) {
            if(state.position) return showToast("ERR", "Position already open");
            const price = parseFloat(el('ft-price').innerText);
            if(!price) return;
            
            const size = parseFloat(el('trade-size').value);
            state.wallet -= (size * 0.001); // Fees
            
            state.position = { side, entry: price, size };
            el('position-box').style.display = 'block';
            el('pos-side').innerText = side.toUpperCase();
            el('pos-entry').innerText = "@ " + price.toFixed(2);
            updateWallet();
            playSound('success');
        }

        function closePosition() {
            if(!state.position) return;
            const price = parseFloat(el('ft-price').innerText);
            const pnlPct = (price - state.position.entry) / state.position.entry * (state.position.side==='long'?1:-1);
            const pnlUsd = state.position.size * pnlPct * 20; // 20x Lev hardcoded for visual
            
            state.wallet += pnlUsd;
            state.history.unshift({ time: new Date().toLocaleTimeString(), pair: state.pair, pnl: pnlUsd });
            state.position = null;
            el('position-box').style.display = 'none';
            updateWallet();
            playSound('ping');
        }

        function updateWallet() {
            el('wallet-bal').innerText = "$" + state.wallet.toLocaleString(undefined, {minimumFractionDigits:2});
        }

        // --- 3. BLOCKCHAIN TAB LOGIC (NEW) ---
        function scanWallet() {
            const addr = el('wallet-addr').value;
            if(addr.length < 10) return showToast("ERR", "Invalid Address");
            
            el('wallet-loading').classList.remove('hidden');
            el('wallet-result').classList.add('hidden');
            
            // SIMULATION OF API CALL
            setTimeout(() => {
                el('wallet-loading').classList.add('hidden');
                el('wallet-result').classList.remove('hidden');
                
                // Randomize Portfolio based on "Whale" status
                const eth = (Math.random() * 100).toFixed(2);
                const usdt = (Math.random() * 500000).toFixed(2);
                const total = (parseFloat(eth)*2000 + parseFloat(usdt));
                
                el('wallet-worth').innerText = "$" + total.toLocaleString();
                el('token-list').innerHTML = `
                    <div class="token-list-item"><span>ETH</span><span>${eth}</span></div>
                    <div class="token-list-item"><span>USDT</span><span>${parseFloat(usdt).toLocaleString()}</span></div>
                    <div class="token-list-item"><span>PEPE</span><span>${(Math.random()*1000000).toFixed(0)}</span></div>
                    <div class="token-list-item"><span>WBTC</span><span>${(Math.random()*2).toFixed(4)}</span></div>
                `;
                showToast("SCAN", "Wallet Data Retrieved");
            }, 1500);
        }

        function updateChainData(price, volatility) {
            // Simulate Gas based on volatility
            const baseGas = 15;
            const gas = Math.floor(baseGas + (volatility * 100));
            el('chain-gas').innerText = gas;
            el('header-gas').innerText = gas;
            
            // Simulate FNG
            if(Math.random() > 0.95) {
                const fng = 60 + Math.floor(Math.random() * 20);
                el('fng-val').innerText = fng;
                el('fng-txt').innerText = fng > 75 ? "EXTREME GREED" : "GREED";
            }

            // Simulate Whale Alerts
            if(Math.random() > 0.9) {
                const amt = (Math.random() * 1000).toFixed(0);
                const coin = Math.random() > 0.5 ? "ETH" : "BTC";
                const div = document.createElement('div');
                div.style.borderBottom = "1px solid #222";
                div.style.padding = "2px 0";
                div.style.color = "var(--purple)";
                div.innerHTML = `üö® <b>${amt} ${coin}</b> transferred from Binance to Unknown Wallet`;
                const list = el('whale-list');
                list.prepend(div);
                if(list.children.length > 8) list.lastChild.remove();
            }
        }

        // --- 4. WEBSOCKETS ---
        function startStream(pair) {
            if(ws) ws.close();
            el('connection-status').innerText = "‚óè SYNCING";
            ws = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${pair}@trade/${pair}@depth10@100ms/${pair}@ticker`);
            
            ws.onopen = () => { el('connection-status').innerText = "‚óè LIVE"; el('connection-status').style.color="var(--green)"; };
            ws.onmessage = (evt) => {
                const msg = JSON.parse(evt.data);
                const data = msg.data;
                const type = msg.stream.split('@')[1];

                if(type === 'trade') {
                    const p = parseFloat(data.p);
                    const q = parseFloat(data.q);
                    
                    // Update Tape
                    const row = document.createElement('div');
                    row.className = 'row';
                    row.innerHTML = `<span style="color:#555">${new Date().toLocaleTimeString()}</span><span style="color:${data.m?'var(--red)':'var(--green)'}">${p.toFixed(2)}</span><span>${q.toFixed(4)}</span>`;
                    el('tape').prepend(row);
                    if(el('tape').children.length > 30) el('tape').lastChild.remove();

                    // Update PnL
                    if(state.position) {
                        const diff = (p - state.position.entry) / state.position.entry;
                        const pct = (state.position.side==='long' ? diff : -diff) * 20; // 20x lev
                        el('pos-pnl').innerText = (pct*100).toFixed(2) + "%";
                        el('pos-pnl').style.color = pct >= 0 ? "var(--green)" : "var(--red)";
                    }

                    // Feed Chain Simulation
                    updateChainData(p, Math.abs(diff || 0));
                }
                
                if(type === 'ticker') {
                    el('ft-price').innerText = parseFloat(data.c).toFixed(2);
                    el('ft-chg').innerText = parseFloat(data.P).toFixed(2) + "%";
                    el('ft-vol').innerText = Math.floor(data.v);
                }

                if(type.startsWith('depth')) {
                    el('asks').innerHTML = data.asks.slice(0,10).reverse().map(a => `<div class="depth-row"><div class="depth-bg bg-ask" style="width:${Math.random()*100}%"></div><span class="depth-val" style="color:var(--red)">${parseFloat(a[0]).toFixed(2)}</span><span class="depth-val">${parseFloat(a[1]).toFixed(3)}</span></div>`).join('');
                    el('bids').innerHTML = data.bids.slice(0,10).map(a => `<div class="depth-row"><div class="depth-bg bg-bid" style="width:${Math.random()*100}%"></div><span class="depth-val" style="color:var(--green)">${parseFloat(a[0]).toFixed(2)}</span><span class="depth-val">${parseFloat(a[1]).toFixed(3)}</span></div>`).join('');
                }
            };
        }

        // --- 5. UI UTILS ---
        function setTab(tab, btn) {
            // Hide all centers
            el('tv-container').classList.add('hidden');
            el('chain-container').classList.add('hidden');
            el('depth-placeholder').classList.add('hidden');
            
            // Remove active classes
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');

            if(tab === 'chart') el('tv-container').classList.remove('hidden');
            if(tab === 'chain') el('chain-container').classList.remove('hidden');
            if(tab === 'depth') el('depth-placeholder').classList.remove('hidden');
        }

        function initTV() {
            if(!window.TradingView) return;
            el('tv-container').innerHTML = '';
            new TradingView.widget({
                "autosize": true, "symbol": "BINANCE:" + state.pair.toUpperCase(), "interval": "1",
                "timezone": "Etc/UTC", "theme": "dark", "style": "1", "locale": "en", "toolbar_bg": "#000",
                "enable_publishing": false, "container_id": "tv-container", "hide_side_toolbar": false,
                "overrides": { "paneProperties.background": "#000000" }
            });
        }

        function startTicker() {
            const tws = new WebSocket('wss://stream.binance.com:9443/ws/!miniTicker@arr');
            tws.onmessage = (e) => {
                const data = JSON.parse(e.data).filter(d => d.s.endsWith('USDT')).sort((a,b)=>parseFloat(b.v)-parseFloat(a.v)).slice(0,15);
                el('global-ticker').innerHTML = data.map(d => `<span class="tick-item" onclick="switchPair('${d.s}')">${d.s.replace('USDT','')} ${parseFloat(d.P).toFixed(1)}%</span>`).join('');
            };
        }

        function showToast(title, msg) {
            const t = document.createElement('div');
            t.className = 'toast pop-toast';
            t.innerHTML = `<b>${title}</b><br>${msg}`;
            el('toast-container').appendChild(t);
            setTimeout(()=>t.remove(), 3000);
        }

        function toggleSound() {
            state.sound = !state.sound;
            if(state.sound) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                showToast("AUDIO", "Sound FX Enabled");
            }
        }
        function playSound(type) {
            if(!state.sound || !audioCtx) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + 0.1);
        }
        function resetApp() { if(confirm("Reset?")) location.reload(); }
        function toggleHistory() { 
            const p = el('history-panel'); 
            p.style.display = p.style.display==='none'?'flex':'none'; 
            el('history-list').innerHTML = state.history.map(h => `<div class="row"><span>${h.time}</span><span>${h.pair}</span><span>${h.pnl.toFixed(2)}$</span></div>`).join('');
        }

        // INIT
        setInterval(() => el('clock').innerText = new Date().toISOString().split('T')[1].split('.')[0] + ' UTC', 1000);
        startStream(state.pair);
        startTicker();
        initTV();

    </script>
</body>
</html>
